# Инструкция по установке автодоната GM-Donate.ru

## Все то, что ниже в 3х-минутном видео
[![Видеоинструкция по установке автодоната](https://user-images.githubusercontent.com/9200174/29837724-a723b8f0-8d01-11e7-9dfa-bf6989ab718b.png)](https://www.youtube.com/watch?v=Ei9kwlOH2VY)

# Прежде, чем мы начнем
Если вдруг возникнут какие-то проблемы, вплоть до полного непонимания процесса установки - [пиши нам](https://qweqwe.ovh/gmdonate-support)

# Базовая терминология
Хочу ознакомить тебя с 2 условными терминами, которые я буду использовать для понятности ниже 
* **КЛИЕНТ** - твой компьютер. Т.е. файлы автодоната, которые скачаны на твой комп 
* **СЕРВЕР** - игровой сервер, на который производится установка автодоната 

# Установка происходит в 4 этапа:
1. **Установка автообновляемой части автодоната**. Мы называем ее IGS (InGameShop). Это делается в 3 клика мышкой
2. **Установка скрипта конфигурации IGS**. Судя по тому, что вы это читаете, вы уже скачали этот аддон. Если нет - сделайте это в панели на сайте gm-donate.ru
3. **Настройка донат итемов**. Т.е. услуг, которые вы будете продавать
4. По желанию, **установка luasocket модуля**. Он нужен для того, чтобы у людей работало мгновенное пополнение счета. В ином случае, счет будет пополняться после перезахода

## Этап #1 - Установка IGS
Открывай в браузере [автообновляемую часть автодоната](http://steamcommunity.com/sharedfiles/filedetails/?id=1083199879). Тебе нужно ее добавить в коллекцию аддонов сервера.
Если не знаешь, как загружать на сервер аддоны из коллекции, то обратись к нам в группу ВК за помощью.

## Этап #2 - Установка конфигуратора IGS
1. На КЛИЕНТЕ и СЕРВЕРЕ открой папку garrysmod/addons
2. На КЛИЕНТЕ с папки addons скопируй в addons на СЕРВЕРЕ папку igsmodification
3. На СЕРВЕРЕ открой garrysmod/addons/igsmodification/lua/igs/settings/config_sv.lua и укажи там [данные проекта](https://img.qweqwe.ovh/1494065855654.png)

## Этап #3 - Настройка продаваемых услуг
1. На СЕРВЕРЕ открой файл garrysmod/addons/igsmodification/lua/igs/settings/sh_additems.lua
2. Настрой его самостоятельно при помощи [документации](https://github.com/GM-DONATE/HELP/blob/master/DOCUMENTATION.md) или [напиши нам](https://qweqwe.ovh/gmdonate-support) и мы настроим его вместо тебя. **Внимательно читай комментарии в файле настроек**. Они избавят тебя от лишних вопросов

## Этап #4 - Установка .dll модуля luasocket
1. На КЛИЕНТЕ и СЕРВЕРЕ открывай папку garrysmod/lua
2. На СЕРВЕРЕ в папке lua создай(!) папку bin (ее, скорее всего, не будет)
3. На КЛИЕНТЕ с папки bin скопируй в папку bin на СЕРВЕРЕ файлы gmsv_socket_linux.dll и gmsv_socket_win32.dll




# И вот что еще.
**Очень важно насчет групп ULX**. Если вы не используете :SetULXGroup(), то дальше можете не читать
<br>После запуска сервера с автодонатом, если вы настраивали услуги с :SetULXGroup(), то вы должны быть готовы к "слету" прав у текущих пользователей после их первого входа.
<br>Дело в том, что автодонат просто НИКАК не может знать почему у игрока такие-то права и на какой они срок у него выданы, поэтому он считает, что права у игрока "нелегальны" и их необходимо снять
<br>Чтобы права не снимались, автодонату необходимо дать знать, что "вот у этого человечка должна быть такая-то группа до такого-то времени".
<br>Сделать это можно через [панель на сайте](https://vk.cc/6DWeLZ) - просто выдайте через эту страницу текущим покупателям групп ULX права вручную и они не будут сниматься до указанного времени

### Чтобы вы лучше понимали, как это работает.
1. Человек заходит на сервер, имея при этом донат группу
2. Автодонат задает вопрос: "Слушай, а не истек ли срок действия твоих прав?" и смотрит имеет ли игрок активную покупку со своей группой
3. Если срок действия прав истек или же игрок их и вовсе никогда не покупал (нет записи в базе данных) - оно решает, что пора бы их снять и снимает

Подобная схема позволяет управлять сроком действия групп прав через панель на сайте. Тоесть, если вы через нее отключите человеку покупку - она исчезнет и на сервере
